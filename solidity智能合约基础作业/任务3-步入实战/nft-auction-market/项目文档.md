项目文档
1. 项目概述
本项目基于 Hardhat 框架实现了一个支持 ETH/ERC20 出价的 NFT 拍卖市场，核心特性包括：
兼容 ERC721 标准的 NFT 铸造与管理；
集成 Chainlink 预言机实现 ETH/ERC20 到 USD 的价格转换，方便跨代币比价；
基于 UUPS 代理模式的合约升级能力，支持逻辑迭代而不改变用户交互地址；
动态手续费机制（拍卖金额越高，手续费比例越低）；
完善的安全防护（重入防护、权限控制、ERC721 接收者校验）。
2. 核心功能说明
2.1 NFT 合约（NFT.sol）
功能	说明
铸造 NFT	仅合约所有者可铸造，支持指定接收地址，tokenId 从 1 自增
设置 Base URI	统一管理 NFT 的元数据前缀，支持后续批量更新
授权 NFT	兼容 ERC721 标准的 approve/setApprovalForAll，支持授权给拍卖合约
2.2 拍卖合约（Auction.sol）
核心功能	详细说明
创建拍卖	卖家上架 NFT，指定出价代币（ETH/ERC20）、开始 / 结束时间，NFT 转移至合约托管
ETH 出价	支持原生 ETH 出价，自动退回上一最高出价者的资金
ERC20 出价	支持任意 ERC20 代币出价，需先授权合约转移代币
USD 比价	通过 Chainlink 预言机将出价金额转换为 USD，方便跨代币比价
结束拍卖	拍卖结束后，NFT 转移给最高出价者，资金扣除手续费后转给卖家；无出价则退回 NFT
动态手续费	出价金额≥1 万 USD，手续费减半；≥1 千 USD，手续费 75 折；默认 1%（万分之 100）
合约升级	基于 UUPS 模式，仅所有者可升级实现合约逻辑
手续费提取	合约所有者可提取累积的手续费（ETH/ERC20）
2.3 Chainlink 预言机集成
ETH/USD 喂价地址（Sepolia）：0x694AA1769357215DE4FAC081bf1f309aDC325306；
支持自定义 ERC20/USD 喂价地址，通过setERC20UsdFeed设置；
价格转换逻辑：将 Chainlink 返回的 8 位小数价格转换为 18 位，适配以太坊代币单位。
3. 项目结构
plaintext
nft-auction-market/
├── contracts/                # 智能合约目录
│   ├── NFT.sol               # ERC721 NFT合约
│   ├── TestERC20.sol         # 测试用ERC20代币
│   └── Auction.sol           # 核心拍卖合约（UUPS+Chainlink）
├── deploy/                   # 部署脚本目录
│   ├── 00-deploy-nft.js      # NFT合约部署
│   ├── 01-deploy-test-erc20.js # 测试ERC20部署
│   └── 02-deploy-auction.js  # 拍卖合约（UUPS）部署
├── test/                     # 测试脚本目录
│   ├── nft.test.js           # NFT合约单元测试
│   └── auction.test.js       # 拍卖合约集成测试
├── .env                      # 环境变量（RPC/私钥/Etherscan API）
├── hardhat.config.js         # Hardhat核心配置
└── package.json              # 项目依赖
4. 部署步骤
4.1 环境准备
安装依赖：
bash
运行
# 初始化项目（若未初始化）
npx hardhat init
# 安装核心依赖
npm install @openzeppelin/contracts @openzeppelin/contracts-upgradeable @chainlink/contracts dotenv
npm install --save-dev hardhat-deploy @nomicfoundation/hardhat-chai-matchers @nomicfoundation/hardhat-ethers ethers solidity-coverage
配置.env文件：
env
# Sepolia RPC URL（从Alchemy/Infura获取）
SEPOLIA_RPC_URL=https://eth-sepolia.g.alchemy.com/v2/[你的API_KEY]
# 测试钱包私钥（请勿泄露）
PRIVATE_KEY=0x[你的钱包私钥]
# Etherscan API Key（用于合约验证）
ETHERSCAN_API_KEY=[你的Etherscan API Key]
配置hardhat.config.js（参考项目交付代码中的配置）。
4.2 本地部署与测试
启动本地节点：
bash
运行
npx hardhat node --no-deploy
部署合约到本地节点（新终端）：
bash
运行
npx hardhat deploy --network localhost
运行测试：
bash
运行
# 基础测试
npx hardhat test
# 生成覆盖率报告
npx hardhat coverage
4.3 部署到 Sepolia 测试网
确保钱包有 Sepolia 测试 ETH（从水龙头获取：https://sepoliafaucet.com/）；
部署合约：
bash
运行
npx hardhat deploy --network sepolia
验证合约（可选）：
bash
运行
# 验证NFT合约
npx hardhat verify --network sepolia [NFT合约地址] "AuctionNFT" "ANFT" "ipfs://test/"
# 验证Auction实现合约（先获取实现地址）
npx hardhat upgrades erc1967:getImplementationAddress --network sepolia [Auction代理地址]
npx hardhat verify --network sepolia [实现合约地址]
